<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.cdnfonts.com/css/gilroy-bold');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-main: #0D1117;
            --bg-secondary: #161B22;
            --bg-tertiary: #21262D;
            --border-color: #30363D;
            --text-primary: #E6EDF3;
            --text-secondary: #8B949E;
            --accent-blue: #58A6FF;
            --accent-green: #3FB950;
            --accent-purple: #A371F7;
            --accent-orange: #F0883E;
            --accent-red: #F85149;
            --accent-gold: #FFD700;
            --shadow-sm: rgba(0, 0, 0, 0.2);
            --shadow-md: rgba(0, 0, 0, 0.4);
            --shadow-lg: rgba(0, 0, 0, 0.6);
        }

        body {
            font-family: 'Gilroy', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Splash Screen */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0D1117 0%, #1a1f2e 50%, #0D1117 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: splashFadeOut 1s ease 2.5s forwards;
        }

        @keyframes splashFadeOut {
            to {
                opacity: 0;
                visibility: hidden;
            }
        }

        .splash-logo {
            font-size: 5rem;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: logoFloat 2s ease-in-out;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .splash-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-top: 1.5rem;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleSlideIn 1s ease;
        }

        @keyframes titleSlideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .splash-creator {
            margin-top: 1rem;
            font-size: 1.1rem;
            color: var(--text-secondary);
            animation: creatorFadeIn 1s ease 0.5s both;
        }

        @keyframes creatorFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .splash-creator span {
            color: var(--accent-blue);
            font-weight: 700;
        }

        /* Floating Info Button */
        .info-fab {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(88, 166, 255, 0.4);
            z-index: 999;
            transition: all 0.3s ease;
            border: none;
        }

        .info-fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 12px 32px rgba(88, 166, 255, 0.6);
        }

        .info-fab i {
            font-size: 1.5rem;
            color: #fff;
        }

        .info-fab.hidden {
            display: none;
        }

        /* Info Modal */
        .info-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .info-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .info-modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2.5rem;
            max-width: 550px;
            width: 100%;
            box-shadow: 0 20px 60px var(--shadow-lg);
            transform: translateY(-50px);
            transition: transform 0.3s ease;
        }

        .info-modal.active .info-modal-content {
            transform: translateY(0);
        }

        .info-modal-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .info-modal-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            color: #fff;
            flex-shrink: 0;
        }

        .info-modal-title {
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .info-modal-body {
            color: var(--text-secondary);
            line-height: 1.8;
            font-size: 1.05rem;
            margin-bottom: 2rem;
        }

        .info-modal-body p {
            margin-bottom: 1rem;
        }

        .info-modal-body strong {
            color: var(--text-primary);
            font-weight: 700;
        }

        .info-modal-features {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .info-feature {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .info-feature i {
            font-size: 1.25rem;
            color: var(--accent-blue);
        }

        .info-feature span {
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .info-modal-footer {
            display: flex;
            justify-content: center;
        }

        .info-close-btn {
            padding: 0.875rem 2rem;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border: none;
            border-radius: 8px;
            color: #fff;
            font-family: 'Gilroy', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .info-close-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(88, 166, 255, 0.4);
        }

        /* Warning Banner */
        .warning-banner {
            background: linear-gradient(135deg, rgba(240, 136, 62, 0.15), rgba(248, 81, 73, 0.15));
            border: 1px solid var(--accent-orange);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: warningPulse 2s ease-in-out infinite;
        }

        @keyframes warningPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(240, 136, 62, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(240, 136, 62, 0); }
        }

        .warning-banner.hidden {
            display: none;
        }

        .warning-icon {
            font-size: 1.5rem;
            color: var(--accent-orange);
            animation: iconShake 0.5s ease infinite;
        }

        @keyframes iconShake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            75% { transform: rotate(10deg); }
        }

        .warning-text {
            flex: 1;
            line-height: 1.6;
        }

        .warning-text strong {
            color: var(--accent-orange);
        }

        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(12px);
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo.hidden {
            display: none;
        }

        .logo i {
            font-size: 1.75rem;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info.hidden {
            display: none;
        }

        /* User Avatar with Initials */
        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: 700;
            color: #fff;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(88, 166, 255, 0.3);
            border: 2px solid var(--border-color);
        }

        .user-details {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .user-fullname {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .user-username {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .header-right {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .points-display {
            display: none;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 1.25rem;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 215, 0, 0.05));
            border: 2px solid var(--accent-gold);
            border-radius: 25px;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .points-display.visible {
            display: flex;
        }

        .points-icon {
            font-size: 1.5rem;
            color: var(--accent-gold);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .points-value {
            color: var(--accent-gold);
            font-size: 1.2rem;
        }

        .header-stats {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0.5rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .stat-item i {
            font-size: 1.1rem;
        }

        .stat-item.todo i { color: var(--accent-orange); }
        .stat-item.progress i { color: var(--accent-blue); }
        .stat-item.done i { color: var(--accent-green); }

        .auth-btn {
            background: var(--accent-blue);
            border: none;
            padding: 0.625rem 1.25rem;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Gilroy', sans-serif;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.2s ease;
        }

        .auth-btn:hover {
            background: #4895E8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(88, 166, 255, 0.3);
        }

        .auth-btn.hidden {
            display: none;
        }

        .logout-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            display: none;
            align-items: center;
            gap: 8px;
            font-family: 'Gilroy', sans-serif;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .logout-btn.visible {
            display: flex;
        }

        .logout-btn:hover {
            background: var(--accent-red);
            border-color: var(--accent-red);
            color: #fff;
        }

        /* Add Task Section */
        .add-task-container {
            max-width: 1600px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .add-task-form {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            display: grid;
            grid-template-columns: 2fr 3fr 1fr 1.5fr auto;
            gap: 1rem;
            box-shadow: 0 4px 12px var(--shadow-sm);
        }

        .form-input {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-family: 'Gilroy', sans-serif;
            font-size: 0.95rem;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            background: var(--bg-main);
        }

        .form-input::placeholder {
            color: var(--text-secondary);
        }

        select.form-input {
            cursor: pointer;
        }

        input[type="datetime-local"].form-input {
            color-scheme: dark;
        }

        .btn-add {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-family: 'Gilroy', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            background: var(--accent-blue);
            color: #fff;
        }

        .btn-add:hover {
            background: #4895E8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(88, 166, 255, 0.3);
        }

        /* Kanban Board with SCROLL */
        .kanban-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 2rem 2rem;
        }

        .kanban-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            align-items: start;
        }

        .kanban-column {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.25rem;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 280px);
            max-height: 650px;
        }

        .column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
            flex-shrink: 0;
        }

        .column-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .column-title i {
            font-size: 1.25rem;
        }

        .column-badge {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
        }

        .column-todo .column-title i { color: var(--accent-orange); }
        .column-todo .column-badge { 
            background: rgba(240, 136, 62, 0.15);
            color: var(--accent-orange);
            border-color: var(--accent-orange);
        }

        .column-progress .column-title i { color: var(--accent-blue); }
        .column-progress .column-badge { 
            background: rgba(88, 166, 255, 0.15);
            color: var(--accent-blue);
            border-color: var(--accent-blue);
        }

        .column-done .column-title i { color: var(--accent-green); }
        .column-done .column-badge { 
            background: rgba(63, 185, 80, 0.15);
            color: var(--accent-green);
            border-color: var(--accent-green);
        }

        .tasks-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding-right: 0.5rem;
        }

        /* Custom Scrollbar */
        .tasks-container::-webkit-scrollbar {
            width: 8px;
        }

        .tasks-container::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        .tasks-container::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
            transition: background 0.2s ease;
        }

        .tasks-container::-webkit-scrollbar-thumb:hover {
            background: var(--accent-blue);
        }

        /* Firefox Scrollbar */
        .tasks-container {
            scrollbar-width: thin;
            scrollbar-color: var(--border-color) var(--bg-tertiary);
        }

        .task-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 1.25rem;
            cursor: move;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        /* Deadline Progress Border - TOP */
        .task-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 4px;
            width: 0%;
            background: transparent;
            transition: width 0.5s linear, background 0.3s ease;
        }

        .task-card.has-deadline::before {
            width: var(--deadline-progress, 0%);
        }

        .task-card.deadline-normal::before {
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
        }

        .task-card.deadline-warning::before {
            background: linear-gradient(90deg, var(--accent-orange), #FFD700);
        }

        .task-card.deadline-urgent::before {
            background: linear-gradient(90deg, var(--accent-red), var(--accent-orange));
            animation: urgentPulse 1s ease-in-out infinite;
        }

        .task-card.deadline-expired::before {
            background: var(--accent-red);
        }

        .task-card.deadline-completed::before {
            width: 100% !important;
            background: var(--accent-green) !important;
            animation: none !important;
        }

        @keyframes urgentPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px var(--shadow-md);
            border-color: var(--accent-blue);
        }

        .task-card.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .task-priority {
            position: absolute;
            top: 1.25rem;
            right: 1rem;
            padding: 0.35rem 0.75rem;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .priority-low {
            background: rgba(63, 185, 80, 0.2);
            color: var(--accent-green);
            border: 1px solid var(--accent-green);
        }

        .priority-medium {
            background: rgba(240, 136, 62, 0.2);
            color: var(--accent-orange);
            border: 1px solid var(--accent-orange);
        }

        .priority-high {
            background: rgba(248, 81, 73, 0.2);
            color: var(--accent-red);
            border: 1px solid var(--accent-red);
        }

        .task-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            padding-right: 60px;
            line-height: 1.4;
            margin-top: 0.25rem;
        }

        .task-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        /* Deadline Info */
        .deadline-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.625rem 0.875rem;
            background: var(--bg-main);
            border-radius: 6px;
            margin-bottom: 1rem;
            font-size: 0.85rem;
        }

        .deadline-label {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-secondary);
        }

        .deadline-time {
            font-weight: 600;
        }

        .deadline-time.normal { color: var(--accent-blue); }
        .deadline-time.warning { color: var(--accent-orange); }
        .deadline-time.urgent { 
            color: var(--accent-red);
            animation: textBlink 1s ease-in-out infinite;
        }
        .deadline-time.expired { color: var(--accent-red); }
        .deadline-time.completed { color: var(--accent-green); }

        @keyframes textBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .task-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-color);
        }

        .task-date {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .task-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            background: var(--bg-main);
            border: 1px solid var(--border-color);
            width: 32px;
            height: 32px;
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            transform: scale(1.1);
            border-color: var(--accent-blue);
            color: var(--text-primary);
        }

        .action-btn.delete:hover {
            border-color: var(--accent-red);
            background: rgba(248, 81, 73, 0.1);
            color: var(--accent-red);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px var(--shadow-lg);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h2 {
            font-size: 1.5rem;
        }

        .close-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            width: 36px;
            height: 36px;
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: var(--accent-red);
            border-color: var(--accent-red);
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group .form-input {
            width: 100%;
        }

        textarea.form-input {
            min-height: 100px;
            resize: vertical;
        }

        .modal-footer {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-family: 'Gilroy', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-main);
            border-color: var(--accent-blue);
        }

        .btn-primary {
            background: var(--accent-blue);
            color: #fff;
        }

        .btn-primary:hover {
            background: #4895E8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(88, 166, 255, 0.3);
        }

        .auth-toggle {
            text-align: center;
            margin-top: 1rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .auth-toggle a {
            color: var(--accent-blue);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }

        .auth-toggle a:hover {
            text-decoration: underline;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 5rem;
            right: 2rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 8px 32px var(--shadow-md);
            display: flex;
            align-items: center;
            gap: 1rem;
            transform: translateX(400px);
            transition: all 0.3s ease;
            z-index: 1001;
            min-width: 280px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 3px solid var(--accent-green);
        }

        .notification.error {
            border-left: 3px solid var(--accent-red);
        }

        .notification i {
            font-size: 1.5rem;
        }

        .notification.success i {
            color: var(--accent-green);
        }

        .notification.error i {
            color: var(--accent-red);
        }

        /* Mobile Nav */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 0.75rem;
            z-index: 100;
        }

        .mobile-nav-items {
            display: flex;
            justify-content: space-around;
            max-width: 600px;
            margin: 0 auto;
        }

        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .mobile-nav-item i {
            font-size: 1.5rem;
        }

        .mobile-nav-item span {
            font-size: 0.7rem;
            font-weight: 600;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-blue);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .kanban-board {
                grid-template-columns: repeat(2, 1fr);
            }

            .add-task-form {
                grid-template-columns: 1fr 1fr;
            }

            .add-task-form .form-input:nth-child(2),
            .add-task-form .form-input:nth-child(4) {
                grid-column: 1 / -1;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .header-left {
                flex-direction: column;
                gap: 0.75rem;
                align-items: flex-start;
                width: 100%;
            }

            .header-right {
                width: 100%;
                justify-content: space-between;
                flex-wrap: wrap;
            }

            .header-stats {
                gap: 0.5rem;
            }

            .stat-item {
                padding: 0.375rem 0.75rem;
                font-size: 0.8rem;
            }

            .points-display {
                padding: 0.5rem 1rem;
                font-size: 0.95rem;
            }

            .add-task-container {
                padding: 0 1rem;
                margin: 1.5rem auto;
            }

            .add-task-form {
                grid-template-columns: 1fr;
                padding: 1rem;
            }

            .kanban-container {
                padding: 0 1rem 6rem;
            }

            .kanban-board {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .kanban-column {
                height: auto;
                max-height: 400px;
            }

            .mobile-nav {
                display: block;
            }

            .modal-content {
                padding: 1.5rem;
            }

            .notification {
                top: 4rem;
                right: 1rem;
                left: 1rem;
            }

            .splash-logo {
                font-size: 3rem;
            }

            .splash-title {
                font-size: 1.75rem;
            }

            .info-fab {
                bottom: 5rem;
                left: 1rem;
                width: 52px;
                height: 52px;
            }

            .info-fab i {
                font-size: 1.25rem;
            }

            .info-modal-content {
                padding: 1.5rem;
            }

            .info-modal-features {
                grid-template-columns: 1fr;
            }

            .user-avatar {
                width: 42px;
                height: 42px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-logo">
            <i class="fas fa-tasks"></i>
        </div>
        <h1 class="splash-title">Task Manager</h1>
        <p class="splash-creator">Created by <span>Farhad Sultanov</span></p>
    </div>

    <!-- Floating Info Button -->
    <button class="info-fab" id="infoFab" onclick="openInfoModal()">
        <i class="fas fa-info"></i>
    </button>

    <!-- Info Modal -->
    <div class="info-modal" id="infoModal" onclick="closeInfoModalOutside(event)">
        <div class="info-modal-content">
            <div class="info-modal-header">
                <div class="info-modal-icon">
                    <i class="fas fa-tasks"></i>
                </div>
                <div class="info-modal-title">Task Manager</div>
            </div>
            <div class="info-modal-body">
                <p>
                    <strong>Professional tapşırıq idarəetmə sistemi</strong> - işlərinizi mükəmməl şəkildə təşkil edin və effektivliyinizi artırın!
                </p>
                <p>
                    Müasir <strong>Kanban Board</strong> texnologiyası ilə tapşırıqlarınızı asanlıqla idarə edin. 
                    Drag & Drop funksiyası, real-time deadline tracking və gamification sistemi ilə 
                    tapşırıqlarınızı tamamlamaq daha maraqlı və motivasiyalıdır.
                </p>

                <div class="info-modal-features">
                    <div class="info-feature">
                        <i class="fas fa-grip-vertical"></i>
                        <span>Drag & Drop</span>
                    </div>
                    <div class="info-feature">
                        <i class="fas fa-clock"></i>
                        <span>Real-time Deadline</span>
                    </div>
                    <div class="info-feature">
                        <i class="fas fa-star"></i>
                        <span>Xal Sistemi</span>
                    </div>
                    <div class="info-feature">
                        <i class="fas fa-bell"></i>
                        <span>Səsli Xəbərdarlıq</span>
                    </div>
                    <div class="info-feature">
                        <i class="fas fa-mobile-alt"></i>
                        <span>Responsive</span>
                    </div>
                    <div class="info-feature">
                        <i class="fas fa-cloud"></i>
                        <span>Cloud Sync</span>
                    </div>
                </div>

                <p style="margin-top: 1rem;">
                    <strong>Giriş edin</strong> və tapşırıqlarınızı qoruma altına alın. 
                    Firebase ilə tam təhlükəsiz və sürətli!
                </p>
            </div>
            <div class="info-modal-footer">
                <button class="info-close-btn" onclick="closeInfoModal()">
                    <i class="fas fa-check"></i> Anladım
                </button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <div class="logo" id="headerLogo">
                    <i class="fas fa-grip-vertical"></i>
                    <h1>Task Manager</h1>
                </div>
                <div class="user-info hidden" id="userInfo">
                    <div class="user-avatar" id="userAvatar">FS</div>
                    <div class="user-details">
                        <div class="user-fullname" id="displayFullname"></div>
                        <div class="user-username" id="displayUsername"></div>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <div class="points-display" id="pointsDisplay">
                    <i class="fas fa-star points-icon"></i>
                    <span class="points-value" id="pointsValue">0</span>
                </div>
                <div class="header-stats">
                    <div class="stat-item todo">
                        <i class="fas fa-circle"></i>
                        <span id="todoCount">0</span>
                    </div>
                    <div class="stat-item progress">
                        <i class="fas fa-circle-half-stroke"></i>
                        <span id="progressCount">0</span>
                    </div>
                    <div class="stat-item done">
                        <i class="fas fa-circle-check"></i>
                        <span id="doneCount">0</span>
                    </div>
                </div>
                <button class="auth-btn" id="loginBtn" onclick="openAuthModal()">
                    <i class="fas fa-sign-in-alt"></i>
                    Giriş
                </button>
                <button class="logout-btn" id="logoutBtn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    Çıxış
                </button>
            </div>
        </div>
    </header>

    <!-- Warning Banner -->
    <div class="add-task-container">
        <div class="warning-banner" id="warningBanner">
            <i class="fas fa-exclamation-triangle warning-icon"></i>
            <div class="warning-text">
                <strong>Diqqət!</strong> Giriş etmədən əlavə edilən tapşırıqlar yaddaşda saxlanılmır. Səhifə yenilənərsə və ya yeni tab açılırsa məlumatlar silinəcək. Tapşırıqlarınızı qorumaq üçün <strong>Giriş edin</strong>.
            </div>
        </div>

        <div class="add-task-form">
            <input type="text" id="taskTitle" class="form-input" placeholder="Tapşırıq başlığı">
            <input type="text" id="taskDesc" class="form-input" placeholder="Tapşırıq təsviri">
            <select id="taskPriority" class="form-input">
                <option value="low">Aşağı Prioritet</option>
                <option value="medium">Orta Prioritet</option>
                <option value="high">Yüksək Prioritet</option>
            </select>
            <input type="datetime-local" id="taskDeadline" class="form-input" title="Son tarix (optional)">
            <button class="btn-add" onclick="addTask()">
                <i class="fas fa-plus"></i>
                Əlavə et
            </button>
        </div>
    </div>

    <!-- Kanban Board -->
    <div class="kanban-container">
        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Yüklənir...</p>
        </div>
        
        <div class="kanban-board">
            <div class="kanban-column column-todo" data-status="todo" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div class="column-header">
                    <div class="column-title">
                        <i class="fas fa-circle"></i>
                        Ediləcək
                    </div>
                    <span class="column-badge" id="todoBadge">0</span>
                </div>
                <div class="tasks-container" id="todoTasks">
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <p>Hələ tapşırıq yoxdur</p>
                    </div>
                </div>
            </div>

            <div class="kanban-column column-progress" data-status="progress" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div class="column-header">
                    <div class="column-title">
                        <i class="fas fa-circle-half-stroke"></i>
                        Davam edir
                    </div>
                    <span class="column-badge" id="progressBadge">0</span>
                </div>
                <div class="tasks-container" id="progressTasks">
                    <div class="empty-state">
                        <i class="fas fa-spinner"></i>
                        <p>Hələ tapşırıq yoxdur</p>
                    </div>
                </div>
            </div>

            <div class="kanban-column column-done" data-status="done" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div class="column-header">
                    <div class="column-title">
                        <i class="fas fa-circle-check"></i>
                        Tamamlandı
                    </div>
                    <span class="column-badge" id="doneBadge">0</span>
                </div>
                <div class="tasks-container" id="doneTasks">
                    <div class="empty-state">
                        <i class="fas fa-check-double"></i>
                        <p>Hələ tapşırıq yoxdur</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Nav -->
    <nav class="mobile-nav">
        <div class="mobile-nav-items">
            <div class="mobile-nav-item" onclick="scrollToColumn('todo')">
                <i class="fas fa-circle"></i>
                <span>Ediləcək</span>
            </div>
            <div class="mobile-nav-item" onclick="scrollToColumn('progress')">
                <i class="fas fa-spinner"></i>
                <span>Davam edir</span>
            </div>
            <div class="mobile-nav-item" onclick="scrollToColumn('done')">
                <i class="fas fa-check"></i>
                <span>Bitdi</span>
            </div>
        </div>
    </nav>

    <!-- Auth Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="authTitle">Giriş</h2>
                <button class="close-btn" onclick="closeAuthModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="loginForm">
                <div class="form-group">
                    <label>Şifrə</label>
                    <input type="password" id="loginPassword" class="form-input" placeholder="Şifrənizi daxil edin">
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="login()">
                    <i class="fas fa-sign-in-alt"></i>
                    Daxil ol
                </button>
                <div class="auth-toggle">
                    Hesabınız yoxdur? <a onclick="toggleAuthMode()">Qeydiyyatdan keçin</a>
                </div>
            </div>

            <div id="registerForm" style="display: none;">
                <div class="form-group">
                    <label>İstifadəçi adı</label>
                    <input type="text" id="registerUsername" class="form-input" placeholder="İstifadəçi adınızı daxil edin">
                </div>
                <div class="form-group">
                    <label>Tam ad</label>
                    <input type="text" id="registerFullname" class="form-input" placeholder="Tam adınızı daxil edin">
                </div>
                <div class="form-group">
                    <label>Şifrə</label>
                    <input type="password" id="registerPassword" class="form-input" placeholder="Şifrə daxil edin">
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="register()">
                    <i class="fas fa-user-check"></i>
                    Qeydiyyatdan keç
                </button>
                <div class="auth-toggle">
                    Hesabınız var? <a onclick="toggleAuthMode()">Daxil olun</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Tapşırığı Redaktə et</h2>
                <button class="close-btn" onclick="closeEditModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="form-group">
                <label>Başlıq</label>
                <input type="text" id="editTitle" class="form-input">
            </div>
            <div class="form-group">
                <label>Təsvir</label>
                <textarea id="editDesc" class="form-input"></textarea>
            </div>
            <div class="form-group">
                <label>Prioritet</label>
                <select id="editPriority" class="form-input">
                    <option value="low">Aşağı</option>
                    <option value="medium">Orta</option>
                    <option value="high">Yüksək</option>
                </select>
            </div>
            <div class="form-group">
                <label>Son tarix (optional)</label>
                <input type="datetime-local" id="editDeadline" class="form-input">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeEditModal()">Ləğv et</button>
                <button class="btn btn-primary" onclick="saveEdit()">
                    <i class="fas fa-save"></i>
                    Yadda saxla
                </button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText"></span>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, update, remove, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCyZyYwXkh7CFbNeNbAr4n3QnjCQoGWSOg",
            authDomain: "mytaskmanager-fee7a.firebaseapp.com",
            databaseURL: "https://mytaskmanager-fee7a-default-rtdb.firebaseio.com",
            projectId: "mytaskmanager-fee7a",
            storageBucket: "mytaskmanager-fee7a.firebasestorage.app",
            messagingSenderId: "900378247881",
            appId: "1:900378247881:web:97089d1c379bbaf7080318",
            measurementId: "G-GJWS1QG2PF"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let currentUser = null;
        let tasks = {};
        let editingTaskId = null;
        let draggedElement = null;
        let isAuthMode = 'login';
        let deadlineUpdateInterval = null;
        let expiredDeadlines = new Set();

        // Audio context for notification sound
        let audioContext = null;
        
        function playNotificationSound() {
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
                
                setTimeout(() => {
                    const osc2 = audioContext.createOscillator();
                    const gain2 = audioContext.createGain();
                    
                    osc2.connect(gain2);
                    gain2.connect(audioContext.destination);
                    
                    osc2.frequency.value = 1000;
                    osc2.type = 'sine';
                    
                    gain2.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gain2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    osc2.start(audioContext.currentTime);
                    osc2.stop(audioContext.currentTime + 0.5);
                }, 200);
                
            } catch (error) {
                console.log('Audio notification failed:', error);
            }
        }

        // Info Modal Functions
        window.openInfoModal = function() {
            document.getElementById('infoModal').classList.add('active');
        };

        window.closeInfoModal = function() {
            document.getElementById('infoModal').classList.remove('active');
        };

        window.closeInfoModalOutside = function(event) {
            if (event.target.id === 'infoModal') {
                closeInfoModal();
            }
        };

        // Generate initials from full name
        function getInitials(fullname) {
            if (!fullname) return 'FS';
            const names = fullname.trim().split(' ');
            if (names.length === 1) {
                return names[0].substring(0, 2).toUpperCase();
            }
            return (names[0][0] + names[names.length - 1][0]).toUpperCase();
        }

        // Generate session ID
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        let sessionId = sessionStorage.getItem('taskManagerSession');
        if (!sessionId) {
            sessionId = generateSessionId();
            sessionStorage.setItem('taskManagerSession', sessionId);
        }

        // Check logged in user
        const savedUser = localStorage.getItem('taskManagerUser');
        if (savedUser) {
            currentUser = JSON.parse(savedUser);
            updateUIForLoggedInUser();
        } else {
            loadSessionTasks();
        }

        function updateUIForLoggedInUser() {
            document.getElementById('loginBtn').classList.add('hidden');
            document.getElementById('logoutBtn').classList.add('visible');
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('pointsDisplay').classList.add('visible');
            document.getElementById('warningBanner').classList.add('hidden');
            document.getElementById('headerLogo').classList.add('hidden');
            document.getElementById('infoFab').classList.add('hidden');
            
            document.getElementById('displayFullname').textContent = currentUser.fullname;
            document.getElementById('displayUsername').textContent = '@' + currentUser.username;
            document.getElementById('userAvatar').textContent = getInitials(currentUser.fullname);
            
            loadUserData();
        }

        function loadUserData() {
            const tasksRef = ref(db, `users/${currentUser.id}/tasks`);
            const userRef = ref(db, `users/${currentUser.id}`);

            onValue(userRef, (snapshot) => {
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    document.getElementById('pointsValue').textContent = userData.points || 0;
                    currentUser.points = userData.points || 0;
                }
            });

            onValue(tasksRef, (snapshot) => {
                tasks = snapshot.val() || {};
                renderAllTasks();
                updateStats();
                startDeadlineUpdates();
            });
        }

        function loadSessionTasks() {
            const sessionTasks = sessionStorage.getItem('sessionTasks');
            if (sessionTasks) {
                tasks = JSON.parse(sessionTasks);
                renderAllTasks();
                updateStats();
                startDeadlineUpdates();
            } else {
                startDeadlineUpdates();
            }
        }

        function saveSessionTasks() {
            if (!currentUser) {
                sessionStorage.setItem('sessionTasks', JSON.stringify(tasks));
            }
        }

        // Auth Modal
        window.openAuthModal = function() {
            document.getElementById('authModal').classList.add('active');
        };

        window.closeAuthModal = function() {
            document.getElementById('authModal').classList.remove('active');
        };

        window.toggleAuthMode = function() {
            isAuthMode = isAuthMode === 'login' ? 'register' : 'login';
            
            if (isAuthMode === 'login') {
                document.getElementById('authTitle').textContent = 'Giriş';
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('registerForm').style.display = 'none';
            } else {
                document.getElementById('authTitle').textContent = 'Qeydiyyat';
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('registerForm').style.display = 'block';
            }
        };

        // Register
        window.register = async function() {
            const username = document.getElementById('registerUsername').value.trim();
            const fullname = document.getElementById('registerFullname').value.trim();
            const password = document.getElementById('registerPassword').value;

            if (!username || !fullname || !password) {
                showNotification('Bütün xanaları doldurun!', 'error');
                return;
            }

            if (username.length < 3) {
                showNotification('İstifadəçi adı ən azı 3 simvol olmalıdır!', 'error');
                return;
            }

            const usersRef = ref(db, 'users');
            const snapshot = await get(usersRef);
            
            if (snapshot.exists()) {
                const users = snapshot.val();
                const existingUser = Object.values(users).find(u => u.username === username);
                if (existingUser) {
                    showNotification('Bu istifadəçi adı artıq mövcuddur!', 'error');
                    return;
                }
            }

            const newUserRef = push(usersRef);
            const userData = {
                username: username,
                fullname: fullname,
                password: password,
                points: 0,
                createdAt: new Date().toISOString()
            };

            await set(newUserRef, userData);
            
            if (Object.keys(tasks).length > 0) {
                for (let taskId in tasks) {
                    const taskRef = push(ref(db, `users/${newUserRef.key}/tasks`));
                    await set(taskRef, tasks[taskId]);
                }
                sessionStorage.removeItem('sessionTasks');
            }
            
            currentUser = { id: newUserRef.key, ...userData };
            localStorage.setItem('taskManagerUser', JSON.stringify(currentUser));
            
            closeAuthModal();
            showNotification('Qeydiyyat uğurlu oldu!', 'success');
            updateUIForLoggedInUser();
        };

        // Login
        window.login = async function() {
            const password = document.getElementById('loginPassword').value;

            if (!password) {
                showNotification('Şifrə daxil edin!', 'error');
                return;
            }

            const usersRef = ref(db, 'users');
            const snapshot = await get(usersRef);
            
            if (!snapshot.exists()) {
                showNotification('Heç bir istifadəçi tapılmadı!', 'error');
                return;
            }

            const users = snapshot.val();
            const userEntry = Object.entries(users).find(([id, u]) => u.password === password);
            
            if (!userEntry) {
                showNotification('Yanlış şifrə!', 'error');
                return;
            }

            if (Object.keys(tasks).length > 0) {
                for (let taskId in tasks) {
                    const taskRef = push(ref(db, `users/${userEntry[0]}/tasks`));
                    await set(taskRef, tasks[taskId]);
                }
                sessionStorage.removeItem('sessionTasks');
            }

            currentUser = { id: userEntry[0], ...userEntry[1] };
            localStorage.setItem('taskManagerUser', JSON.stringify(currentUser));
            
            closeAuthModal();
            showNotification('Xoş gəldiniz!', 'success');
            updateUIForLoggedInUser();
        };

        // Logout
        window.logout = function() {
            if (confirm('Çıxış etmək istədiyinizdən əminsiniz?')) {
                localStorage.removeItem('taskManagerUser');
                sessionStorage.removeItem('sessionTasks');
                location.reload();
            }
        };

        // Add Task
        window.addTask = function() {
            const title = document.getElementById('taskTitle').value.trim();
            const description = document.getElementById('taskDesc').value.trim();
            const priority = document.getElementById('taskPriority').value;
            const deadline = document.getElementById('taskDeadline').value;

            if (!title) {
                showNotification('Tapşırıq başlığı daxil edin!', 'error');
                return;
            }

            const task = {
                title: title,
                description: description,
                priority: priority,
                status: 'todo',
                deadline: deadline || null,
                createdAt: new Date().toISOString()
            };

            if (currentUser) {
                const tasksRef = ref(db, `users/${currentUser.id}/tasks`);
                const newTaskRef = push(tasksRef);
                set(newTaskRef, task).then(() => {
                    clearTaskForm();
                    showNotification('Tapşırıq əlavə edildi!', 'success');
                });
            } else {
                const taskId = Date.now().toString();
                tasks[taskId] = task;
                saveSessionTasks();
                renderAllTasks();
                updateStats();
                clearTaskForm();
                showNotification('Tapşırıq əlavə edildi! (Yadda saxlanmır)', 'error');
            }
        };

        function clearTaskForm() {
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskDesc').value = '';
            document.getElementById('taskPriority').value = 'low';
            document.getElementById('taskDeadline').value = '';
        }

        // Drag and Drop
        window.allowDrop = function(event) {
            event.preventDefault();
            const column = event.currentTarget;
            column.style.background = 'rgba(88, 166, 255, 0.05)';
        };

        window.drag = function(event) {
            draggedElement = event.target;
            event.target.classList.add('dragging');
        };

        window.drop = function(event) {
            event.preventDefault();
            const column = event.currentTarget;
            column.style.background = '';

            if (!draggedElement) return;

            const newStatus = column.dataset.status;
            const taskId = draggedElement.dataset.taskId;
            const oldStatus = tasks[taskId]?.status;

            if (taskId && tasks[taskId]) {
                if (currentUser) {
                    update(ref(db, `users/${currentUser.id}/tasks/${taskId}`), {
                        status: newStatus
                    }).then(() => {
                        handlePointsUpdate(taskId, oldStatus, newStatus);
                    });
                } else {
                    tasks[taskId].status = newStatus;
                    saveSessionTasks();
                    renderAllTasks();
                    updateStats();
                    showNotification('Tapşırıq köçürüldü!', 'success');
                }
            }

            draggedElement.classList.remove('dragging');
            draggedElement = null;
        };

        window.dragEnd = function(event) {
            event.target.classList.remove('dragging');
            const columns = document.querySelectorAll('.kanban-column');
            columns.forEach(col => col.style.background = '');
        };

        window.dragLeave = function(event) {
            if (event.currentTarget === event.target) {
                event.currentTarget.style.background = '';
            }
        };

        function handlePointsUpdate(taskId, oldStatus, newStatus) {
            if (!currentUser) return;

            if (newStatus === 'done' && oldStatus !== 'done') {
                const pointsToAdd = tasks[taskId].priority === 'high' ? 15 : 
                                  tasks[taskId].priority === 'medium' ? 10 : 5;
                const newPoints = (currentUser.points || 0) + pointsToAdd;
                
                update(ref(db, `users/${currentUser.id}`), { points: newPoints });
                showNotification(`Tapşırıq tamamlandı! +${pointsToAdd} xal`, 'success');
            } else if (oldStatus === 'done' && newStatus !== 'done') {
                const pointsToRemove = tasks[taskId].priority === 'high' ? 15 : 
                                      tasks[taskId].priority === 'medium' ? 10 : 5;
                const newPoints = Math.max(0, (currentUser.points || 0) - pointsToRemove);
                
                update(ref(db, `users/${currentUser.id}`), { points: newPoints });
                showNotification('Tapşırıq köçürüldü!', 'success');
            } else {
                showNotification('Tapşırıq köçürüldü!', 'success');
            }
        }

        // Delete Task
        window.deleteTask = function(taskId) {
            if (confirm('Bu tapşırığı silmək istədiyinizdən əminsiniz?')) {
                const task = tasks[taskId];
                
                if (currentUser) {
                    if (task.status === 'done') {
                        const pointsToRemove = task.priority === 'high' ? 15 : 
                                              task.priority === 'medium' ? 10 : 5;
                        const newPoints = Math.max(0, (currentUser.points || 0) - pointsToRemove);
                        update(ref(db, `users/${currentUser.id}`), { points: newPoints });
                    }
                    
                    remove(ref(db, `users/${currentUser.id}/tasks/${taskId}`)).then(() => {
                        showNotification('Tapşırıq silindi!', 'success');
                    });
                } else {
                    delete tasks[taskId];
                    saveSessionTasks();
                    renderAllTasks();
                    updateStats();
                    showNotification('Tapşırıq silindi!', 'success');
                }
            }
        };

        // Edit Task
        window.editTask = function(taskId) {
            editingTaskId = taskId;
            const task = tasks[taskId];
            
            document.getElementById('editTitle').value = task.title;
            document.getElementById('editDesc').value = task.description;
            document.getElementById('editPriority').value = task.priority;
            document.getElementById('editDeadline').value = task.deadline || '';
            
            document.getElementById('editModal').classList.add('active');
        };

        window.saveEdit = function() {
            const title = document.getElementById('editTitle').value.trim();
            const description = document.getElementById('editDesc').value.trim();
            const priority = document.getElementById('editPriority').value;
            const deadline = document.getElementById('editDeadline').value;

            if (!title) {
                showNotification('Başlıq daxil edin!', 'error');
                return;
            }

            const updates = {
                title: title,
                description: description,
                priority: priority,
                deadline: deadline || null
            };

            if (currentUser) {
                update(ref(db, `users/${currentUser.id}/tasks/${editingTaskId}`), updates).then(() => {
                    closeEditModal();
                    showNotification('Tapşırıq yeniləndi!', 'success');
                });
            } else {
                tasks[editingTaskId] = { ...tasks[editingTaskId], ...updates };
                saveSessionTasks();
                renderAllTasks();
                updateStats();
                closeEditModal();
                showNotification('Tapşırıq yeniləndi!', 'success');
            }
        };

        window.closeEditModal = function() {
            document.getElementById('editModal').classList.remove('active');
            editingTaskId = null;
        };

        // Calculate deadline progress
        function calculateDeadlineProgress(task) {
            if (!task.deadline) return null;

            const now = new Date().getTime();
            const deadlineTime = new Date(task.deadline).getTime();
            const createdTime = new Date(task.createdAt).getTime();
            
            const totalTime = deadlineTime - createdTime;
            const timeElapsed = now - createdTime;
            const timeRemaining = deadlineTime - now;

            if (task.status === 'done') {
                return {
                    percentage: 100,
                    timeLeft: 'Tamamlandı',
                    status: 'completed',
                    timeRemaining: timeRemaining
                };
            }

            let percentage = Math.max(0, Math.min(100, (timeElapsed / totalTime) * 100));

            if (timeRemaining < 0) {
                return {
                    percentage: 100,
                    timeLeft: 'Vaxt keçib',
                    status: 'expired',
                    timeRemaining: timeRemaining
                };
            }

            const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);

            let timeLeft = '';
            if (days > 0) timeLeft = `${days}g ${hours}s ${minutes}d`;
            else if (hours > 0) timeLeft = `${hours}s ${minutes}d`;
            else if (minutes > 0) timeLeft = `${minutes}d ${seconds}s`;
            else timeLeft = `${seconds}s`;

            let status = 'normal';
            if (timeRemaining < 3600000) {
                status = 'urgent';
            } else if (timeRemaining < 86400000) {
                status = 'warning';
            }

            return {
                percentage,
                timeLeft,
                status,
                timeRemaining
            };
        }

        // Check for expired deadlines
        function checkExpiredDeadlines() {
            Object.entries(tasks).forEach(([taskId, task]) => {
                if (task.deadline && task.status !== 'done') {
                    const now = new Date().getTime();
                    const deadlineTime = new Date(task.deadline).getTime();
                    
                    if (now >= deadlineTime && !expiredDeadlines.has(taskId)) {
                        expiredDeadlines.add(taskId);
                        playNotificationSound();
                        showNotification(`⏰ "${task.title}" son tarixi keçdi!`, 'error');
                        
                        if ("Notification" in window && Notification.permission === "granted") {
                            new Notification("Son tarix keçdi!", {
                                body: `"${task.title}" tapşırığının son tarixi keçdi!`,
                                icon: "https://cdn-icons-png.flaticon.com/512/2838/2838779.png"
                            });
                        }
                    }
                }
            });
        }

        // Update all deadline progress bars
        function updateAllDeadlineProgress() {
            Object.entries(tasks).forEach(([taskId, task]) => {
                if (task.deadline) {
                    const progress = calculateDeadlineProgress(task);
                    if (progress) {
                        const taskCard = document.querySelector(`[data-task-id="${taskId}"]`);
                        if (taskCard) {
                            taskCard.style.setProperty('--deadline-progress', `${progress.percentage}%`);
                            
                            const deadlineTimeEl = taskCard.querySelector('.deadline-time');
                            if (deadlineTimeEl) {
                                deadlineTimeEl.textContent = progress.timeLeft;
                                deadlineTimeEl.className = `deadline-time ${progress.status}`;
                            }
                            
                            taskCard.className = `task-card has-deadline deadline-${progress.status}`;
                        }
                    }
                }
            });
            
            checkExpiredDeadlines();
        }

        // Render Tasks
        function renderAllTasks() {
            const statuses = ['todo', 'progress', 'done'];
            
            statuses.forEach(status => {
                const container = document.getElementById(`${status}Tasks`);
                const filteredTasks = Object.entries(tasks).filter(([id, task]) => task.status === status);
                
                if (filteredTasks.length === 0) {
                    const emptyIcons = {
                        todo: 'fa-clipboard-list',
                        progress: 'fa-spinner',
                        done: 'fa-check-double'
                    };
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas ${emptyIcons[status]}"></i>
                            <p>Hələ tapşırıq yoxdur</p>
                        </div>
                    `;
                } else {
                    container.innerHTML = filteredTasks.map(([id, task]) => createTaskCard(id, task)).join('');
                }

                document.getElementById(`${status}Badge`).textContent = filteredTasks.length;
            });
        }

        function createTaskCard(id, task) {
            const date = new Date(task.createdAt);
            const formattedDate = date.toLocaleDateString('az-AZ', { 
                day: 'numeric', 
                month: 'short'
            });

            const priorityLabels = {
                low: 'Aşağı',
                medium: 'Orta',
                high: 'Yüksək'
            };

            let deadlineHtml = '';
            let deadlineClasses = '';
            let deadlineProgress = '';
            
            if (task.deadline) {
                const progress = calculateDeadlineProgress(task);
                if (progress) {
                    deadlineClasses = `has-deadline deadline-${progress.status}`;
                    deadlineProgress = `style="--deadline-progress: ${progress.percentage}%"`;
                    
                    deadlineHtml = `
                        <div class="deadline-info">
                            <div class="deadline-label">
                                <i class="fas fa-clock"></i>
                                Son tarix
                            </div>
                            <div class="deadline-time ${progress.status}">
                                ${progress.timeLeft}
                            </div>
                        </div>
                    `;
                }
            }

            return `
                <div class="task-card ${deadlineClasses}" 
                     ${deadlineProgress}
                     draggable="true" 
                     data-task-id="${id}"
                     ondragstart="drag(event)"
                     ondragend="dragEnd(event)">
                    <span class="task-priority priority-${task.priority}">
                        ${priorityLabels[task.priority]}
                    </span>
                    <h3 class="task-title">${task.title}</h3>
                    <p class="task-description">${task.description || 'Təsvir yoxdur'}</p>
                    ${deadlineHtml}
                    <div class="task-footer">
                        <div class="task-date">
                            <i class="fas fa-calendar-alt"></i>
                            <span>${formattedDate}</span>
                        </div>
                        <div class="task-actions">
                            <button class="action-btn" onclick="editTask('${id}')" title="Redaktə et">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteTask('${id}')" title="Sil">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Start deadline updates
        function startDeadlineUpdates() {
            if (deadlineUpdateInterval) {
                clearInterval(deadlineUpdateInterval);
            }
            
            deadlineUpdateInterval = setInterval(() => {
                updateAllDeadlineProgress();
            }, 1000);
        }

        // Update Stats
        function updateStats() {
            const statusCounts = {
                todo: 0,
                progress: 0,
                done: 0
            };

            Object.values(tasks).forEach(task => {
                if (statusCounts.hasOwnProperty(task.status)) {
                    statusCounts[task.status]++;
                }
            });

            document.getElementById('todoCount').textContent = statusCounts.todo;
            document.getElementById('progressCount').textContent = statusCounts.progress;
            document.getElementById('doneCount').textContent = statusCounts.done;
        }

        // Notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            const icon = notification.querySelector('i');

            notificationText.textContent = message;
            notification.className = `notification ${type}`;
            
            if (type === 'success') {
                icon.className = 'fas fa-check-circle';
            } else {
                icon.className = 'fas fa-exclamation-circle';
            }

            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        window.scrollToColumn = function(status) {
            const column = document.querySelector(`[data-status="${status}"]`);
            if (column) {
                column.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        };

        document.getElementById('authModal').addEventListener('click', (e) => {
            if (e.target.id === 'authModal') {
                closeAuthModal();
            }
        });

        document.getElementById('editModal').addEventListener('click', (e) => {
            if (e.target.id === 'editModal') {
                closeEditModal();
            }
        });

        document.getElementById('taskTitle').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addTask();
            }
        });

        document.querySelectorAll('.kanban-column').forEach(col => {
            col.addEventListener('dragleave', dragLeave);
        });

        document.addEventListener('click', () => {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }, { once: true });
    </script>
</body>
</html>
